# 数据寻址方案

存储系统的核心功能是数据的存取， 实现这一目标的前提是正确、高效的数据寻址策 略， 即存储系统首要解决的问题是数据写到哪里去， 数据从哪里读出。&#x20;

经过学术界和工业界多年的探索和实践， 数据寻址的方式基本被归结为两大类， 分别是查表型寻址方式（有中心的非对称式架构） 与计算型寻址方式（无中心的对称式架构）， 下面将对两类方案做详细对比。

## 查表型寻址方式

在早期的数据系统中， 基于查表的数据寻址是很自然且有效的方式， 至今诸多系统都 仍在使用。 比如单机文件系统， 从创建至今， 依然是以该方式为主， 不论是像Ext4、Zfs这类基 于多级数组的方式， 还是Btrfs这类基于B-Tree的方式， 本质上都是基于查表的实现， 区别仅仅在千优化查表的时间效率和空间利用率上。在数据系统的另一大领域一<mark style="color:purple;">**数据库**</mark>系统中， 当今流行的不论是基于B-Tree或是基于LSM-Tree的存储引擎， 都没有绕开使 用查表这一方式来解决数据位置映射问题。

对千分布式存储系统， 较早时期的系统架沟设计中会很自然地沿用这种由单机系统延伸出来的已有特性， 所以查表方式也被分布式存储系统广泛采纳并加以实现。这类系统中 的典型代表是大家比较熟悉的由Google发表在SOSP'03上的<mark style="color:purple;">**GFS(Google FileS ystem)**</mark> 分布式存储系统，

GFS是一个具有松散POSIX语义的文件系统，面向大文件场景进行优化， 它的典型特征是数据与索引分离进行存储， 即数据面的核心操作不会经过索引面， 而索引面解决的问题就是人们关心的数据寻址问题。

GFS将所有元数据存储于所谓的Master节点上， Master节点应对前端对数据路由的 查询和更新操作， 是全局寻址信息的权威记录， 这样的设计称为“中心化索引＂ ， 中心化索 引的架构具备简单且高效的特性， 基于数据、索引分离的设计理念使得Master节点不会 成为整个系统1/0操作的瓶颈， 而面向大文件的设计场景也使得元数据的规模不会非常大， 有效地规避了拓展性问题。GFS这类系统架构并不完美， 在应对海量小文件的场景下会产生诸多问题。当然，GFS通过层级存储（Layering Storage)的设计依靠BigTable缓解 了这一问题， 但在海量小文件存储场景下， 中心化索引面临的性能问题和架构劣势仍会逐 步凸显出来。

值得肯定的是，GFS这类架构引领了分布式存储10年的风向标， 有大量的系统追随 这一架构。或者说， GFS更像是那个时代最佳的分布式存储系统元数据索引解决方案。 后来， 随着业界对基于中心索引架构带来的一系列如SPOF(Single Point of Fa廿ure)、 元数据性能／规模等司题的探索， 大家越来越倾向于使用shared-nothing的方式来解决 分布式存储的架构问题， 这一阶段大痲的系统涌现出来， 包括Swift、Ceph、Dynamo等， 它们都采用了所谓的“去中心化索引＂ 的方式进行架构设计， 也就是基于计算的寻址方式。

## 计算型寻址方式

如果将CPU-Intensive的索引寻址操作置于中心节点， 中心节点必然面临性能瓶颈， 如果我们能够采用分而治之的方式， 将寻址操作分散到更多甚至集群中所有的存储节点中 去，就可以有效地解决这个问题。“分而治之” 即要求各节点能够基于本地状态进行寻址自 治， 而在分布式系统中， 特别是使用普通商用服务器进行部署的大规模系统， 各节点具有 天生的故障可能性， 当一个节点掉线，其数据／状态就有可能无法恢复， 所以必须设计出 一套能够具有让数据在无状态节点之间进行寻址能力的系统， 显然， 只有基于计算才具备 实现这一能力的可能。当然， 从本书后文对Ceph存储系统的CRUSH算法描述来说，存 储节点并不是完全的无状态， 存储系统需要依赖一小部分集群信息进行数据存储位置的计 算寻址。
